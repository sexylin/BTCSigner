import {ethers} from "ethers";
import {AbiCoder} from "ethers/src.ts/abi/abi-coder";

async function deployContract() {
    const provider = new ethers.JsonRpcProvider("https://testnet.sapphire.oasis.dev");
    // 替换为你的私钥或签名账户
    const privateKey = "0x5bf7359f5dbe78497510572a59e15219725bdaa45f5894dae8b69ec00dadff00";
    const wallet = new ethers.Wallet(privateKey);

    // 替换为你的合约 ABI 和 bytecode
    const contractABI = [
        {
            "inputs": [
                {
                    "internalType": "bytes",
                    "name": "pers",
                    "type": "bytes"
                }
            ],
            "stateMutability": "nonpayable",
            "type": "constructor"
        },
        {
            "inputs": [
                {
                    "internalType": "bytes",
                    "name": "contextOrHash",
                    "type": "bytes"
                }
            ],
            "name": "signBTCTransaction",
            "outputs": [
                {
                    "internalType": "bytes",
                    "name": "sigs",
                    "type": "bytes"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "bytes",
                    "name": "contextOrHash",
                    "type": "bytes"
                },
                {
                    "internalType": "bytes",
                    "name": "signature",
                    "type": "bytes"
                }
            ],
            "name": "verifySignature",
            "outputs": [
                {
                    "internalType": "bool",
                    "name": "flag",
                    "type": "bool"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        }
    ]; // 替换为你的合约 ABI
    const contractBytecode = "0x60c06040523480156200001157600080fd5b5060006200003b6020604051806020016040528060008152506200008860201b620002e81760201c565b9050806200004990620002da565b6080818152505060006200006a6005836200018060201b620003d71760201c565b509050806200007990620002da565b60a08181525050505062000807565b606060008073010000000000000000000000000000000000000173ffffffffffffffffffffffffffffffffffffffff168585604051602001620000cd929190620003f4565b604051602081830303815290604052604051620000eb91906200046a565b600060405180830381855afa9150503d806000811462000128576040519150601f19603f3d011682016040523d82523d6000602084013e6200012d565b606091505b50915091508162000175576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016200016c90620004e4565b60405180910390fd5b809250505092915050565b60608060008073010000000000000000000000000000000000000573ffffffffffffffffffffffffffffffffffffffff168686604051602001620001c692919062000586565b604051602081830303815290604052604051620001e491906200046a565b600060405180830381855afa9150503d806000811462000221576040519150601f19603f3d011682016040523d82523d6000602084013e62000226565b606091505b5091509150816200026e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162000265906200060a565b60405180910390fd5b8080602001905181019062000284919062000782565b9350935050509250929050565b600081519050919050565b6000819050602082019050919050565b6000819050919050565b6000620002c48251620002ac565b80915050919050565b600082821b905092915050565b6000620002e78262000291565b82620002f3846200029c565b90506200030081620002b6565b9250602082101562000343576200033e7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff83602003600802620002cd565b831692505b5050919050565b6000819050919050565b6200035f816200034a565b82525050565b600082825260208201905092915050565b60005b838110156200039657808201518184015260208101905062000379565b60008484015250505050565b6000601f19601f8301169050919050565b6000620003c08262000291565b620003cc818562000365565b9350620003de81856020860162000376565b620003e981620003a2565b840191505092915050565b60006040820190506200040b600083018562000354565b81810360208301526200041f8184620003b3565b90509392505050565b600081905092915050565b6000620004408262000291565b6200044c818562000428565b93506200045e81856020860162000376565b80840191505092915050565b600062000478828462000433565b915081905092915050565b600082825260208201905092915050565b7f72616e646f6d42797465733a206661696c656400000000000000000000000000600082015250565b6000620004cc60138362000483565b9150620004d98262000494565b602082019050919050565b60006020820190508181036000830152620004ff81620004bd565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602160045260246000fd5b6009811062000549576200054862000506565b5b50565b60008190506200055c8262000535565b919050565b60006200056e826200054c565b9050919050565b620005808162000561565b82525050565b60006040820190506200059d600083018562000575565b8181036020830152620005b18184620003b3565b90509392505050565b7f67656e207369676e696e67206b6579706169723a206661696c65640000000000600082015250565b6000620005f2601b8362000483565b9150620005ff82620005ba565b602082019050919050565b600060208201905081810360008301526200062581620005e3565b9050919050565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6200068482620003a2565b810181811067ffffffffffffffff82111715620006a657620006a56200064a565b5b80604052505050565b6000620006bb6200062c565b9050620006c9828262000679565b919050565b600067ffffffffffffffff821115620006ec57620006eb6200064a565b5b620006f782620003a2565b9050602081019050919050565b60006200071b6200071584620006ce565b620006af565b9050828152602081018484840111156200073a576200073962000645565b5b6200074784828562000376565b509392505050565b600082601f83011262000767576200076662000640565b5b81516200077984826020860162000704565b91505092915050565b600080604083850312156200079c576200079b62000636565b5b600083015167ffffffffffffffff811115620007bd57620007bc6200063b565b5b620007cb858286016200074f565b925050602083015167ffffffffffffffff811115620007ef57620007ee6200063b565b5b620007fd858286016200074f565b9150509250929050565b60805160a051610db96200082c60003960006101e90152600060cf0152610db96000f3fe608060405234801561001057600080fd5b50600436106100365760003560e01c80638acdf2011461003b578063f6e548e91461006b575b600080fd5b61005560048036038101906100509190610556565b61009b565b6040516100629190610667565b60405180910390f35b61008560048036038101906100809190610689565b6101b5565b6040516100929190610758565b60405180910390f35b606060008073010000000000000000000000000000000000000673ffffffffffffffffffffffffffffffffffffffff1660057f0000000000000000000000000000000000000000000000000000000000000000898989896040516020016101079695949392919061083f565b60405160208183030381529060405260405161012391906108d2565b600060405180830381855afa9150503d806000811461015e576040519150601f19603f3d011682016040523d82523d6000602084013e610163565b606091505b5091509150816101a8576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161019f90610946565b60405180910390fd5b8092505050949350505050565b600080600073010000000000000000000000000000000000000773ffffffffffffffffffffffffffffffffffffffff1660057f00000000000000000000000000000000000000000000000000000000000000008b8b8b8b8b8b604051602001610225989796959493929190610966565b60405160208183030381529060405260405161024191906108d2565b600060405180830381855afa9150503d806000811461027c576040519150601f19603f3d011682016040523d82523d6000602084013e610281565b606091505b5091509150816102c6576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016102bd90610a20565b60405180910390fd5b808060200190518101906102da9190610a6c565b925050509695505050505050565b606060008073010000000000000000000000000000000000000173ffffffffffffffffffffffffffffffffffffffff16858560405160200161032b929190610ab2565b60405160208183030381529060405260405161034791906108d2565b600060405180830381855afa9150503d8060008114610382576040519150601f19603f3d011682016040523d82523d6000602084013e610387565b606091505b5091509150816103cc576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103c390610b2e565b60405180910390fd5b809250505092915050565b60608060008073010000000000000000000000000000000000000573ffffffffffffffffffffffffffffffffffffffff16868660405160200161041b929190610b4e565b60405160208183030381529060405260405161043791906108d2565b600060405180830381855afa9150503d8060008114610472576040519150601f19603f3d011682016040523d82523d6000602084013e610477565b606091505b5091509150816104bc576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016104b390610bca565b60405180910390fd5b808060200190518101906104d09190610d0b565b9350935050509250929050565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b60008083601f840112610516576105156104f1565b5b8235905067ffffffffffffffff811115610533576105326104f6565b5b60208301915083600182028301111561054f5761054e6104fb565b5b9250929050565b600080600080604085870312156105705761056f6104e7565b5b600085013567ffffffffffffffff81111561058e5761058d6104ec565b5b61059a87828801610500565b9450945050602085013567ffffffffffffffff8111156105bd576105bc6104ec565b5b6105c987828801610500565b925092505092959194509250565b600081519050919050565b600082825260208201905092915050565b60005b838110156106115780820151818401526020810190506105f6565b60008484015250505050565b6000601f19601f8301169050919050565b6000610639826105d7565b61064381856105e2565b93506106538185602086016105f3565b61065c8161061d565b840191505092915050565b60006020820190508181036000830152610681818461062e565b905092915050565b600080600080600080606087890312156106a6576106a56104e7565b5b600087013567ffffffffffffffff8111156106c4576106c36104ec565b5b6106d089828a01610500565b9650965050602087013567ffffffffffffffff8111156106f3576106f26104ec565b5b6106ff89828a01610500565b9450945050604087013567ffffffffffffffff811115610722576107216104ec565b5b61072e89828a01610500565b92509250509295509295509295565b60008115159050919050565b6107528161073d565b82525050565b600060208201905061076d6000830184610749565b92915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602160045260246000fd5b600981106107b3576107b2610773565b5b50565b60008190506107c4826107a2565b919050565b60006107d4826107b6565b9050919050565b6107e4816107c9565b82525050565b6000819050919050565b6107fd816107ea565b82525050565b82818337600083830152505050565b600061081e83856105e2565b935061082b838584610803565b6108348361061d565b840190509392505050565b600060808201905061085460008301896107db565b61086160208301886107f4565b8181036040830152610874818688610812565b90508181036060830152610889818486610812565b9050979650505050505050565b600081905092915050565b60006108ac826105d7565b6108b68185610896565b93506108c68185602086016105f3565b80840191505092915050565b60006108de82846108a1565b915081905092915050565b600082825260208201905092915050565b7f7369676e3a206661696c65640000000000000000000000000000000000000000600082015250565b6000610930600c836108e9565b915061093b826108fa565b602082019050919050565b6000602082019050818103600083015261095f81610923565b9050919050565b600060a08201905061097b600083018b6107db565b610988602083018a6107f4565b818103604083015261099b81888a610812565b905081810360608301526109b0818688610812565b905081810360808301526109c5818486610812565b90509998505050505050505050565b7f7665726966793a206661696c6564000000000000000000000000000000000000600082015250565b6000610a0a600e836108e9565b9150610a15826109d4565b602082019050919050565b60006020820190508181036000830152610a39816109fd565b9050919050565b610a498161073d565b8114610a5457600080fd5b50565b600081519050610a6681610a40565b92915050565b600060208284031215610a8257610a816104e7565b5b6000610a9084828501610a57565b91505092915050565b6000819050919050565b610aac81610a99565b82525050565b6000604082019050610ac76000830185610aa3565b8181036020830152610ad9818461062e565b90509392505050565b7f72616e646f6d42797465733a206661696c656400000000000000000000000000600082015250565b6000610b186013836108e9565b9150610b2382610ae2565b602082019050919050565b60006020820190508181036000830152610b4781610b0b565b9050919050565b6000604082019050610b6360008301856107db565b8181036020830152610b75818461062e565b90509392505050565b7f67656e207369676e696e67206b6579706169723a206661696c65640000000000600082015250565b6000610bb4601b836108e9565b9150610bbf82610b7e565b602082019050919050565b60006020820190508181036000830152610be381610ba7565b9050919050565b600080fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b610c278261061d565b810181811067ffffffffffffffff82111715610c4657610c45610bef565b5b80604052505050565b6000610c596104dd565b9050610c658282610c1e565b919050565b600067ffffffffffffffff821115610c8557610c84610bef565b5b610c8e8261061d565b9050602081019050919050565b6000610cae610ca984610c6a565b610c4f565b905082815260208101848484011115610cca57610cc9610bea565b5b610cd58482856105f3565b509392505050565b600082601f830112610cf257610cf16104f1565b5b8151610d02848260208601610c9b565b91505092915050565b60008060408385031215610d2257610d216104e7565b5b600083015167ffffffffffffffff811115610d4057610d3f6104ec565b5b610d4c85828601610cdd565b925050602083015167ffffffffffffffff811115610d6d57610d6c6104ec565b5b610d7985828601610cdd565b915050925092905056fea2646970667358221220b05fd7a576e3dc30d5853558f5990f29c55eaf187645e1cc0cf5c0c9d0eda8ba64736f6c63430008120033"; // 替换为你的合约字节码

    // 合约构造函数参数
    const initialValue = 42; // 替换为你的实际参数值

    // 构造部署交易
    const deployTransaction = {
        to: null,
        gasLimit: 2000000, // 根据实际情况设置 gasLimit
        gasPrice: ethers.parseUnits("125", "gwei"), // 根据实际情况设置 gasPrice
        data: contractBytecode,
    };

    // 签名并发送部署交易
    const signedTransaction = await wallet.signTransaction(deployTransaction);
    const transaction = await provider.broadcastTransaction(signedTransaction);

    // 等待交易确认
    await provider.waitForTransaction(transaction.hash);

    // 获取新合约地址
    const receipt = await provider.getTransactionReceipt(transaction.hash);
    const deployedContractAddress = receipt?.contractAddress;

    console.log("Deployed Contract Address:", deployedContractAddress);
}

deployContract();
